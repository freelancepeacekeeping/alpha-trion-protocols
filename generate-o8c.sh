TMP_BUILD='tmp-build/f44befce-4d6d-4fb9-a286-9585f36aece9/Sets/62539654-4c65-40e5-b87d-13fb1e573735/Cards/'
NAME="$1"

OrangeBattleCard[1]="5c57cea4-b909-40e6-9cc5-e738d09da61d"
OrangeBattleCard[2]="fa59f4ef-28db-4cd4-99d3-1ab7f24b3452"
BlueBattleCard[1]="a7714f3c-0046-49f3-af41-e781386f87dc"
BlueBattleCard[2]="c9f79696-047c-477c-9423-654cd401911c"
WhiteBattleCard[1]="d8425243-038b-470f-9101-40b084775017"
WhiteBattleCard[2]="b1d61c53-b1e7-4fd7-acc5-bcf2058feec4"
BlackBattleCard[1]="88080fac-0417-4a2f-9ca5-87df04efb00d"
BlackBattleCard[2]="5449419d-9403-4d3f-9efb-a28448ee5e19"
GreenBattleCard[1]="de059900-c2f9-476a-b276-b8523684d5f8"
GreenBattleCard[2]="b1336881-5b74-4b95-8487-7955cc4dac3e"
OrangeBlackBattleCard[1]="2b2a8a6c-e22f-4ea6-9091-62806b3b8147"
OrangeBlackBattleCard[2]="adaf4498-0fb2-422d-b45c-29d2d1937d8f"
BlueBlackBattleCard[1]="4f888bbc-6485-42f6-a238-c123f03d8d90"
BlueBlackBattleCard[2]="45666ca7-df4d-4c4c-907f-be90d25f29b9"
WhiteBlackBattleCard[1]="0cce447c-3bdf-452f-b555-2ddf4e5314b2"
WhiteBlackBattleCard[2]="eaf73bc9-27f4-428d-895d-7d743fd04cbb"
GreenBlackBattleCard[1]="1d2b8a34-1f4d-4d6c-aee0-367876d2cc5a"
GreenBlackBattleCard[2]="da083ef7-9895-4084-9242-e7cabfd050a5"
GreenWhiteBattleCard[1]="47da8716-092d-4508-9843-8ccc0aed18b8"
GreenWhiteBattleCard[2]="5a4aa88a-d98e-4075-a84d-86b92ebbeda4"
OrangeBlueBattleCard[1]="4776cb59-e08a-4837-9f69-48788175dac4"
DoubleOrangeBattleCard[1]="d7fe79c4-800a-49bd-a9b9-7b88c4fab609"
DoubleBlueBattleCard[1]="45ae4dbd-9102-4553-a006-948bed6673f6"
LargeCharacter[1]="30c7cb0d-c258-438c-aa1d-487965be3082"
LargeCharacter[2]="917e24a0-b4ed-4425-8c22-a7edbdb347b9"
LargeCharacter[3]="1803179b-c572-4632-9267-05e3060c39af"
LargeCharacter[4]="2ac7ec25-f1c0-4f32-bade-be20de319746"
LargeCharacter[5]="801858a1-b9bb-4fcd-9688-656f688ad233"
LargeCharacter[6]="271174bb-c9bf-45c7-b60a-3671cd44d045"
LargeCharacter[7]="dc52423a-4f23-4aef-a370-dc017ff864a5"
LargeCharacter[8]="88bb917f-017f-486a-be3b-9be568f07c81"
LargeCharacter[9]="44d5bc35-47b5-4300-b570-6d6d76bf340f"
LargeCharacter[10]="4cebd192-6d4c-4b2d-9ac1-f3455fd7368c"
SmallCharacter[1]="590d4e03-a5b4-4346-850a-50ecc92c2293"
SmallCharacter[2]="dbcb2a79-56bb-45b6-8261-7f17a3169c60"
SmallCharacter[3]="b790df31-4647-45e7-970b-ef031a03d34a"
SmallCharacter[4]="decec750-5800-4f6e-8aed-724cac4ed73a"
SmallCharacter[5]="acb3e73b-d028-414c-af20-346f7fb241ae"
SmallCharacter[6]="034065cf-12ce-4591-9f50-3914360d3629"
SmallCharacter[7]="32f55142-8a20-4442-894e-db303d046426"
SmallCharacter[8]="8bf956a9-c75a-444a-8d67-dcd9ee657dae"
SmallCharacter[9]="d6c42f90-5392-4840-a092-a511a1616c62"
SmallCharacter[10]="2f9bd646-7dff-4219-a3b3-0de5cf100e98"
ExtraLargeCharacter[1]="ceffd5ba-3dad-40f6-b34e-0a0eede2a4ea"
ExtraLargeCharacter[2]="4d147dc7-9c61-46ae-8252-e23e43ac740e"
ExtraLargeCharacter[3]="c1851be8-3e0b-491c-a835-bd6b42b504fa"
ExtraLargeCharacter[4]="40ac7e96-9c0c-43fd-bc7a-c08ffb9ac336"
Stratagem[1]="4385348a-1969-4974-980b-708e4dd59998"
Stratagem[2]="53b1f61d-4a28-48af-854e-0b8a3254d51f"
Stratagem[3]="05e8925a-f4c2-4641-8873-aca3c9bc2740"
Stratagem[4]="316f0e8f-fffc-4dbe-b573-41e2d2ad2efd"
Stratagem[5]="65797513-c97a-4102-a479-95c53e909179"
Stratagem[6]="69d9bdc0-8b76-42ac-a0a4-d026337f8c40"
Stratagem[7]="4f35b261-3b7a-4531-a824-5da303d3e0aa"
Stratagem[8]="adeacaba-a20c-484c-bce3-0c499f63bbe3"
Stratagem[9]="b6aa1149-930f-4d32-9948-b0457e3927c9"
Stratagem[10]="08018652-8fcd-4456-aeb7-196cd3326b60"

function prepare() {
    count=1
    directory=$1
    # A side-effect of using 1-indexed arrays above is that it allows this function
    # to leave the directory as the 0'th element of the array when it rebuilds the array below
    octgn=("$@")    

    if [ ! -d ${directory} ]
    then
        return
    fi

    find -L ${directory} -type f -name "*.png" -print0 | while IFS= read -r -d '' file; do
        if [[ "$file" != *".1.png"* ]]
        then
            guid=${octgn[$count]}
            if [ ! "${guid}" ]
            then
                guid="NO_${directory}_${count}"
            fi

            echo "Converting ${file} to ${guid}"

            alt=`echo ${file} | sed 's/\.png/.1.png/'`
             
            if test -f "$alt"
            then
                convert "${alt}" -resize x805 "${TMP_BUILD}/${guid}.png"
                convert "${file}" -resize x805 "${TMP_BUILD}/${guid}.bot.png"
            else
                convert "${file}" -resize x805 "${TMP_BUILD}/${guid}.png"
            fi

            ((count=count+1))
        fi
    done
}

mkdir -p ${TMP_BUILD}
rm -f ${NAME}.o8c

prepare 'Stratagems' "${Stratagem[@]}"
prepare 'Large' "${LargeCharacter[@]}"
prepare 'Small' "${SmallCharacter[@]}"
prepare 'Extra-Large' "${ExtraLargeCharacter[@]}"
prepare 'Battle-Cards/OU' "${OrangeBlueBattleCard[@]}"

cd tmp-build
echo "Creating ${NAME}.o8c"
zip -qr ../${NAME}.o8c f44befce-4d6d-4fb9-a286-9585f36aece9
cd ..
rm -fr tmp-build
